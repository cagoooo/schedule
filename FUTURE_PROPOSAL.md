# 學校預約系統：未來優化與開發建議書 (FUTURE_PROPOSAL v2.37.6+)

**適用系統**：禮堂&專科教室&IPAD平板車預約系統  
**基準版本**：v2.37.6 (2026-02-23)  
**文件目的**：提供全方位、可落地執行的開發路線圖，依優先順序與複雜度分層列出。

---

## ✅ 近期已完成里程碑 (已完成，勿重複開發)

| 功能 | 版本 |
| :--- | :---: |
| PWA 安裝體驗（Glassmorphism UI + 標題修正） | v2.37.6 |
| 歷史記錄強制刪除 / 月份查詢 | v2.37.0 |
| 今日預約熱度圖（空閒段視覺修正）| v2.37.5 |
| Bento Grid 數據儀表板 + CSV 匯出 + 月報表 | v2.36.0~37.0 |
| AI 衝突建議替代方案 | v2.33.1 |
| 使用者自助取消（裝置綁定）| v2.36.0 |
| GitHub Actions CI/CD 自動部署 | v2.31.0 |

---

## 🔥 第一階段：近期高影響力優化（建議 1~2 個月內完成）

### 1.1 🔔 LINE Notify / LINE Bot 預約通知整合

**痛點**：使用者預約成功後沒有任何主動通知，容易忘記，或需手動回系統確認。  
**解法**：
1. 建立 LINE Official Account 或申請 LINE Notify Token（個人免費）。
2. 預約確認時推播：`📅 預約確認 | [張老師] 已成功預約 [禮堂] 2026/03/05 第三節`
3. **提前 1 小時**自動發送使用提醒：`⏰ 即將使用提醒 | 1小時後您有禮堂預約，請準時前往。`
4. 取消預約時推播：`❌ 預約已取消 | [禮堂] 2026/03/05 第三節 取消成功。`

**技術路徑**：
- **Firebase Cloud Functions** 監聽 Firestore 事件，呼叫 LINE Messaging API。
- 或使用 **Firebase Scheduled Functions** 每整點掃描「1 小時後預約」清單。

**預估效益**：⭐⭐⭐⭐⭐  
**技術難度**：⭐⭐（LINE API 文件完整，Cloud Functions 整合一次到位）  
**預計開發時間**：3~5 天

---

### 1.2 🎭 多角色權限分層管理（Sub-Admin Roles）

**痛點**：目前僅有單一管理員帳號，無法區分「設備組」與「場地組」的管理職責。  
**解法**：

| 角色 | 管理範圍 | 可操作動作 |
| :--- | :--- | :--- |
| **超級管理員** | 全部場地 + 系統設定 | 所有權限 + 匯出 + 帳號管理 |
| **場地管理員** | 禮堂 / 專科教室 / 森林小屋 | 取消、封鎖時段、查看報表 |
| **設備管理員** | IPAD 平板車（三~六年級）| 取消、查看借用紀錄 |
| **一般使用者** | — | 僅預約 + 取消自己的預約 |

**技術路徑**：Firebase Auth **Custom Claims** 設定角色（`role: "device_admin"`），  
Firestore Rules 根據 Claim 決定讀寫範圍，UI 根據角色動態顯隱按鈕。

**預估效益**：⭐⭐⭐⭐⭐  
**技術難度**：⭐⭐⭐  
**預計開發時間**：5~7 天

---

### 1.3 🌙 深色模式（Dark Mode）

**痛點**：長時間使用或夜間操作時眼睛負擔大，且年輕教師普遍喜好深色主題。  
**解法**：
1. 在 CSS 中定義 `:root[data-theme="dark"]` 的 CSS 變數覆蓋集。
2. 深色調色盤：背景 `#0f1117`、卡片 `#1a1f2e`、主題色 `#818cf8`（靛紫）、危險 `#f87171`。
3. 右上角加入切換按鈕（月亮 🌙 / 太陽 ☀️ 圖示），設定記錄至 `localStorage`。
4. 也支援 `prefers-color-scheme: dark` 媒體查詢自動跟隨系統。

**預估效益**：⭐⭐⭐⭐  
**技術難度**：⭐⭐  
**預計開發時間**：2~3 天

---

### 1.4 📋 常用預約範本（Quick Templates）

**痛點**：固定社團課、集會等每週重複的活動，每次都要重新填寫相同資訊。  
**解法**：
1. 在預約彈窗增加「 📌 套用範本」選單。
2. 管理員或使用者可將常用預約設定（場地、節次、預約者、理由）「另存為範本」。
3. 範本資料存入 Firestore `templates` Collection，依使用者裝置/帳號查詢。

**預估效益**：⭐⭐⭐⭐  
**技術難度**：⭐⭐  
**預計開發時間**：2~3 天

---

## 🌟 第二階段：中期核心升級（建議 2~4 個月）

### 2.1 📅 Google Calendar 雙向同步

**功能描述**：
- 預約成功後，自動將事件寫入學校 Google 公用行事曆（使用 Google Calendar API）。
- 提供 **`.ics` 訂閱連結**，讓老師用任何行事曆 App 訂閱「場地預約總覽」。
- 取消預約時同步從 Google Calendar 移除。

**技術路徑**：Firebase Cloud Functions + Google Calendar API v3 Service Account 授權。  
**預估效益**：⭐⭐⭐⭐  
**技術難度**：⭐⭐⭐⭐  
**預計開發時間**：7~10 天

---

### 2.2 📊 進階分析儀表板（Analytics v2）

**現有儀表板的限制**：只顯示當日資料，缺少跨週/跨月的趨勢分析。  
**強化方向**：

| 新增功能 | 說明 |
| :--- | :--- |
| **學期使用率熱力圖** | 類似 GitHub Contribution Graph，顯示每日預約密度 |
| **場地使用率排行榜** | 哪個場地最搶手，哪個最閒置 |
| **班級/老師預約頻率** | 找出最活躍使用者 |
| **取消率分析** | 哪個時段/場地被取消最多，可能存在排課問題 |
| **預約提前天數分佈** | 了解老師的預約習慣 |

**技術路徑**：Firestore Aggregation Query + Chart.js / D3.js 視覺化。

---

### 2.3 📬 Email 通知（進階版）

**背景**：若老師不使用 LINE，需提供 Email 備援通知管道。  
**解法**：整合 **Firebase Extension: Trigger Email**，預約事件觸發寄送格式化 HTML 郵件：
- 📧 預約確認信（含 .ics 行事曆附件）
- ⏰ 使用前 24 小時提醒信
- ❌ 取消確認信

---

### 2.4 🔁 預約轉讓功能

**痛點**：老師無法出席時，除了取消，無法將預約「轉讓」給其他老師。  
**解法**：
1. 預約詳情加入「轉讓預約」按鈕。
2. 輸入被轉讓者姓名後，系統更新預約者並寫入稽核日誌。
3. 被轉讓者收到 LINE / Email 通知。

---

### 2.5 🔍 全文搜尋最佳化（Firestore 複合索引）

**背景**：目前搜尋需拉取大量資料在前端過濾，效能不佳。  
**解法**：
1. 優化 Firestore 複合索引（`classroom + date`、`bookerName + date`）。
2. 考慮整合 **Algolia** 或 **Typesense** 提供全文搜尋 API，支援模糊搜尋、拼音搜尋。

---

## 🔮 第三階段：長期願景（4 個月以上）

### 3.1 📱 原生 App 開發（PWA 進化）

**現狀**：目前 PWA 支援離線與主畫面安裝，但使用體驗仍次於原生 App。  
**方向選擇**：

| 方案 | 優點 | 缺點 |
| :--- | :--- | :--- |
| **Progressive Web App 強化** | 無需上架，即時更新 | 功能受瀏覽器限制 |
| **React Native / Flutter** | 近原生體驗，上架 App Store | 開發成本高，審核週期長 |
| **Capacitor（Ionic）** | 現有 Web 程式碼包裝成 App | 效能介於兩者之間 |

**建議**：先強化 PWA（Background Sync、Push Notifications API），若使用量足夠再考慮 Capacitor。

---

### 3.2 📷 QR Code 到場簽到 & 物聯網連動

**情境描述**：
1. 老師到達禮堂，掃描門口二維碼 QR Code。
2. 系統驗證預約有效，顯示「✅ 簽到成功」。
3. 自動觸發智慧插座 API 開啟電燈、冷氣（Tuya / Xiaomi Smart API）。
4. 使用結束後掃描「簽退碼」，系統自動關閉電源。

**額外效益**：精準記錄「實際使用時間」，可計算設備耗電量與使用率。  
**技術路徑**：QR Code + Firebase → Cloud Functions → IoT 智慧插座 Webhook。

---

### 3.3 🤖 AI 智慧學期白皮書生成

**功能描述**：每學期末，系統自動分析全學期資料，產出 PDF 報告，包含：
- 各場地使用率趨勢（折線圖）
- 最搶手時段 Top 10
- 最常被取消的時段（分析異常原因）
- 各年級借用 IPAD 頻率
- 下學期場地需求預測

**技術路徑**：Firebase Scheduled Function（學期末觸發）+ Gemini API 幫助自動生成分析段落 + jsPDF 產生 PDF。

---

### 3.4 🧩 排課系統整合（校務系統 API）

**長遠目標**：與學校排課系統（e.g. 學校 ERP / ClassLink）對接，預約時自動帶入老師課表，避免與正課時間衝突。

---

## 📊 建議優先執行順序（ROI 排行）

| 優先順序 | 功能 | 效益 | 難度 | 建議時程 |
| :---: | :--- | :---: | :---: | :---: |
| 🥇 1 | LINE Notify 通知整合 | ⭐⭐⭐⭐⭐ | ⭐⭐ | 1~2 週 |
| 🥈 2 | 深色模式 | ⭐⭐⭐⭐ | ⭐⭐ | 3~5 天 |
| 🥉 3 | 常用預約範本 | ⭐⭐⭐⭐ | ⭐⭐ | 3~5 天 |
| 4 | 多角色權限分層 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | 1~2 週 |
| 5 | 進階分析儀表板 v2 | ⭐⭐⭐⭐ | ⭐⭐⭐ | 2~3 週 |
| 6 | Google Calendar 同步 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 2~3 週 |
| 7 | Email 通知整合 | ⭐⭐⭐ | ⭐⭐ | 1 週 |
| 8 | 預約轉讓功能 | ⭐⭐⭐ | ⭐⭐ | 1 週 |
| 9 | PWA 強化（Push Notifications）| ⭐⭐⭐ | ⭐⭐⭐ | 2 週 |
| 10 | QR Code 簽到 & IoT 連動 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 1~2 個月 |
| 11 | AI 學期白皮書生成 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 1 個月 |
| 12 | 原生 App（Capacitor）| ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 2~3 個月 |

---

> [!TIP]
> **建議從 LINE Notify 開始**！這是讓系統從「被動查詢工具」進化為「主動服務助手」的最關鍵一步，且技術門檻低、效果立竿見影。

> [!NOTE]
> 每個功能在開始開發前，建議先確認：①是否符合學校資安政策 ②是否需要申請額外 GCP 費用預算（Cloud Functions 超出免費額度的情況）。

> [!IMPORTANT]
> **LINE Notify 將於 2025 年 3 月停止服務**，建議直接採用 **LINE Messaging API（LINE Bot）** 方案，避免短期內再次遷移。

---

*文件最後更新：2026-02-23 | 版本 v2.37.6*
